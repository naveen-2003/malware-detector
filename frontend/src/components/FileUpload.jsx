import axios from "axios";

const FileUpload = ({ setData, file, setFile, setIsFileUploading }) => {
  const browseFile = () => {
    document.getElementById("file").click();
  };
  const handleUpload = () => {
    setIsFileUploading(true);
    const formData = new FormData();
    formData.append("file", file);
    axios
      .post("http://192.168.78.128:5000/upload", formData)
      .then((res) => {
        setIsFileUploading(false);
        console.log(res.data);
        setData(res.data);
        setFile(null);
      })
      .catch((err) => {
        console.log(err);
      });
  };
  const handleDragOver = (e) => {
    e.preventDefault();
  };
  const handleDrop = (e) => {
    e.preventDefault();
    if (e.dataTransfer.files) {
      setFile(e.dataTransfer.files[0]);
      // handleUpload();
    }
  };

  return (
    <>
      <div className="h-screen w-screen flex justify-center">
        <div
          className={`bg-white  mx-0 my-auto px-10 py-10  max-w-xl w-full shadow-[0px_4px_4px_rgba(0,0,0,0.25)] rounded-[32px]`}
        >
          <div className="pb-2">
            <span className="text-[#4A7AF6] font-bold text-2xl">
              Upload File
            </span>
          </div>
          <div className="pt-2">
            <span className="text-[#6D6666]">Upload the file to be tested</span>
          </div>
          <div
            onDragOver={handleDragOver}
            onDrop={handleDrop}
            className="mx-8 mb-5 mt-12 flex flex-col justify-center px-10 py-8 bg-[#EFEFEF] border-dashed border-4 border-black rounded-[32px]"
          >
            {file ? (
              <div className="flex justify-center">
                <span className="text-[#6D6666]">{file.name}</span>
              </div>
            ) : (
              <>
                <div className="flex justify-center">
                  <img
                    className=" w-24 "
                    src="./src/assets/upload-file.svg"
                    alt="Upload File"
                  />
                </div>
                <div className="flex justify-center mt-8">
                  <span className="text-[#6D6666]">
                    Drag and drop files here
                  </span>
                </div>
                <div className="flex justify-center mt-3">
                  <span className="text-[#6D6666]">~OR~</span>
                </div>
              </>
            )}
            <div className="flex flex-row justify-center gap-5">
              {!file ? (
                <div className="flex justify-center mt-3">
                  <button
                    className="px-5 pb-2 pt-1 rounded-full text-[#EFEFEF] font-bold bg-[#4A7AF6]"
                    onClick={browseFile}
                  >
                    Browse
                  </button>
                </div>
              ) : (
                <div className="flex justify-center mt-3">
                  <button
                    className="px-5 pb-2 pt-1 rounded-full text-[#EFEFEF] font-bold bg-[#4A7AF6]"
                    onClick={handleUpload}
                  >
                    Upload
                  </button>
                </div>
              )}
            </div>
            <input
              type="file"
              name="file"
              onChange={(e) => {
                setFile(e.target.files[0]);
              }}
              id="file"
              className="hidden"
            />
          </div>
        </div>
      </div>
    </>
  );
};

export default FileUpload;
